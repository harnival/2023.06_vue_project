<template>
    <div>
        <input type="text" v-model="searchs">제목
        <input type="text" v-model="artists">채널
        <button @click="getId">api</button>
        <div>
            <div v-for="item in videos" :key="item.id">
                <h4>{{ item.title }}</h4>
                <img :src="item.thumbnail" width="200">
            </div>
        </div>
    </div>
</template>

<script setup>
import axios from 'axios';
import {ref as dataRef, get, child} from 'firebase/database';
import {useDatabase} from '../datasources/firebase.js'
import { onMounted, ref, reactive } from 'vue';
// API key 받아오기 ----------------------------------------------- //
let APIkey = ref('');
async function getKey(){
  const q = await get(child(dataRef(useDatabase), 'API_key'));
  if( q.exists()){
    console.log(q.val());
    APIkey = q.val();
  } else {
    const r = console.log('not has API key.') 
  }
}
onMounted(function(){
    getKey();
})
//----------------------------------------------------------------

let videos = ref([]);
let searchs = ref('attention');
let artists = ref('NewJeans')

async function getId(){
    const res = await axios.get("https://www.googleapis.com/youtube/v3/search",{
        params: {
            part: 'snippet',
            type: 'video',
            key: APIkey,
            q: searchs.value + " Auto-generated by YouTube.",
            videoCategoryId: '10',
            videoSyndicated: 'true',
            maxResults: 5
        }
    });
    videos.value = res.data.items.map(item => ({
        id: item.id.videoId,
        title: item.snippet.title,
        thumbnail: item.snippet.thumbnails.high.url
    }));
    
    console.log(`https://www.youtube.com/watch?v=${videos.value[0].id}`);
    console.log(videos.value);
}

</script>